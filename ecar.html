<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />
        <link rel="stylesheet" type="text/css" href="index.css" />
        <link rel="stylesheet" type="text/css" href="main.css" />

        <!--<link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" type="text/css" href="css/main.css" />-->

<title>Universal App - ECAR</title>
    </head>
    <body>
        <div id="container">
            <div id="centered">
                <p class='white uniTitle center' style='font-size:.9em;'><a href="index.html"><img src='logo.png' width='80' border='0'></a> UNIVERSAL APP</p>
                <div id="topNav">
                    <a id="navAppsLink" class="pccBlue rounded-corners paddingFive" href="javascript:app.showApps()">&lt; Apps</a>
                    <a id="navECARsLink" class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.getRecords()">ECARs</a>
                    <a id="navSearchECARsLink" class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.showSearchForm()">Search ECARs</a>
                    <a id="navECARDetailsLink" class="pccBlue rounded-corners paddingFive" href="">ECAR Details</a>
                </div>
                
                <div id="searchFormDiv" class="center rounded-corners">
                    <!-- filled in from ecar.js > displayECARs -->
                    <a href='javascript:Ecar.closeSearchForm()'><img src='close_icon.png' width=32 height=32 id='overlayCloseButton' /></a>
                    <form id="searchForm">
                        <!-- have to replace this with sent JSON data -->
                        <table class="searchFormTable">
    <tbody>
      <tr>
            <td align="right">CAR ID: </td>
            <td><input type="text" name="param_car~id_s_n_80" value=""></td>
      </tr>
      <tr>
            <td align="right">Type of CAR: </td>
            <td><select name="param_car~type_s_n_40">
                  <option value="">ANY</option>
                        <option value="IT">IT</option>
                        <option value="NON-IT">NON-IT</option>
                        <option value="POD (TIMET ONLY)">POD (TIMET ONLY)</option>
                      </select>
            </td>
      </tr>
      <tr>
        <td align="right">Division Name: </td>
        <td>
            <select name="param_division~name_i_n_6">
            <option value="">ANY</option>
                        <option value="6">Airfoils</option>
                        <option value="5">Corporate</option>
                        <option value="10">Disc Ops</option>
                        <option value="1">Fasteners</option>
                        <option value="7">Forged Products</option>
                        <option value="8">PCC Aerostructures</option>
                        <option value="4">SMC</option>
                        <option value="3">Structurals</option>
                        <option value="9">Structurals (SCO)</option>
                        <option value="11">Timet</option>
                        <option value="2">Wyman</option>
                      </select>
        </td>
      </tr>
      <tr>
        <td align="right">Plant Name: </td>
      </tr>
      <tr>
        <td colspan=2><select name="param_plant~name_i_n_6">
            <option value="">ANY</option>
                        <optgroup label="Airfoils">
                        <option value="683">AETC</option>
                        <option value="701">Airfoils Division HQ</option>
                        <option value="700">Cannon-Muskegon</option>
                        <option value="687">Ceramics</option>
                        <option value="682">Deer Creek</option>
                        <option value="686">Douglas</option>
                        <option value="681">Mentor</option>
                        <option value="688">Mexico</option>
                        <option value="684">Minerva</option>
                        <option value="685">SMP</option>
                        </optgroup>
                        <optgroup label="Corporate">
                        <option value="727">Corporate Office</option>
                        </optgroup>
                        <optgroup label="Disc Ops">
                        <option value="679">Advanced Forming Technology (AFT)</option>
                        <option value="680">AFTE</option>
                        <option value="733">Thailand Machining</option>
                        </optgroup>
                        <optgroup label="Fasteners">
                        <option value="658">AAA Aircraft Supply LLC</option>
                        <option value="663">Air Industries Company (AIC)</option>
                        <option value="668">Airdrome Precision Components</option>
                        <option value="662">AVK Industrial Products</option>
                        <option value="664">Cherry Aerospace</option>
                        <option value="699">Division HQ or Group</option>
                        <option value="678">E-One</option>
                        <option value="737">Faber</option>
                        <option value="667">Fatigue Technology (FTI)</option>
                        <option value="657">Greer Stop Nut</option>
                        <option value="656">Jenkintown</option>
                        <option value="677">JL Fiber Services</option>
                        <option value="747">Kun Shan Tooling</option>
                        <option value="675">Metalac</option>
                        <option value="676">NSS</option>
                        <option value="709">PB Fasteners</option>
                        <option value="785">Permaswage California</option>
                        <option value="787">Permaswage China</option>
                        <option value="786">Permaswage France</option>
                        <option value="719">Precision Tool Group - Hi-Life Tools</option>
                        <option value="698">Precision Tool Group - Kadimi</option>
                        <option value="721">Precision Tool Group - Reed</option>
                        <option value="722">Precision Tool Group - SPS China</option>
                        <option value="665">Santa Ana</option>
                        <option value="666">Shur-Lok Company</option>
                        <option value="673">Shur-Lok International</option>
                        <option value="702">SPS International Trading Co</option>
                        <option value="659">SPS Unbrako Japan</option>
                        <option value="669">T.J. Brooks</option>
                        </optgroup>
                        <optgroup label="PCC Aerostructures">
                        <option value="674">AF Aerospace</option>
                        <option value="790">Alloy Proc</option>
                        <option value="660">Avibank Manufacturing</option>
                        <option value="661">Avibank Services LLC</option>
                        <option value="758">Brittain</option>
                        <option value="745">CANMEX</option>
                        <option value="734">Centra Industries Inc.</option>
                        <option value="757">Compass NW</option>
                        <option value="744">Dorval</option>
                        <option value="778">Exacta Aerospace</option>
                        <option value="760">Fortner</option>
                        <option value="741">GCM North America</option>
                        <option value="761">Helicomb</option>
                        <option value="777">KaliStrut Aerospace </option>
                        <option value="740">Klune KPC</option>
                        <option value="738">Klune North Hollywood</option>
                        <option value="739">Klune Spanish Fork</option>
                        <option value="672">Kun Shan Aerostructures</option>
                        <option value="743">McSwain</option>
                        <option value="746">Mexico Queretaro</option>
                        <option value="752">Plasma Coating</option>
                        <option value="711">Primus - Accra</option>
                        <option value="712">Primus - Auburn</option>
                        <option value="713">Primus - Bangkok</option>
                        <option value="714">Primus - Farnborough</option>
                        <option value="715">Primus - Suzhou</option>
                        <option value="716">Primus - University Swaging</option>
                        <option value="717">Primus - Waldens</option>
                        <option value="718">Primus Bellevue</option>
                        <option value="750">ProCoat</option>
                        <option value="742">Progressive</option>
                        <option value="670">SPS Aerostructures - Annesley</option>
                        <option value="671">SPS Aerostructures - Mansfield</option>
                        <option value="756">Stratoflight</option>
                        <option value="751">SW United</option>
                        <option value="753">SW United Canada</option>
                        <option value="754">SW United Mexico</option>
                        <option value="755">Sync Aero</option>
                        <option value="759">Weaver</option>
                        </optgroup>
                        <optgroup label="SMC">
                        <option value="703">AlloyWorks</option>
                        <option value="633">Beachwood</option>
                        <option value="638">Caledonian</option>
                        <option value="637">Greenville</option>
                        <option value="636">Hereford</option>
                        <option value="634">Huntington</option>
                        <option value="635">New Hartford</option>
                        <option value="726">Newton</option>
                        <option value="784">Overall Forge</option>
                        <option value="641">Singapore</option>
                        <option value="791">SOS Metals</option>
                        <option value="640">WASA</option>
                        <option value="639">Wire Group</option>
                        </optgroup>
                        <optgroup label="Structurals">
                        <option value="723">ASC</option>
                        <option value="690">Carson City</option>
                        <option value="629">DDC</option>
                        <option value="630">Division HQ</option>
                        <option value="692">Groton</option>
                        <option value="695">GSC</option>
                        <option value="781">LPC Combined (Do not use)</option>
                        <option value="708">LPC-Steel</option>
                        <option value="780">LPC-Ti</option>
                        <option value="631">PCC France</option>
                        <option value="691">San Leandro</option>
                        <option value="632">Schlosser</option>
                        <option value="689">SSBO</option>
                        <option value="694">Tilton/Franklin</option>
                        </optgroup>
                        <optgroup label="Timet">
                        <option value="764">Division HQ</option>
                        <option value="763">Timet Elim</option>
                        <option value="766">Timet Europe</option>
                        <option value="767">Timet Henderson</option>
                        <option value="774">Timet Loterios</option>
                        <option value="769">Timet Morgantown</option>
                        <option value="771">Timet NA Service Centers</option>
                        <option value="762">Timet North America</option>
                        <option value="772">Timet PFP</option>
                        <option value="775">Timet Savoie</option>
                        <option value="770">Timet Toronto</option>
                        <option value="773">Timet UK</option>
                        <option value="783">Waunarlwydd</option>
                        <option value="782">Witton</option>
                        </optgroup>
                        <optgroup label="Wyman">
                        <option value="735">Aerocraft Heat Treating</option>
                        <option value="697">Arcturus</option>
                        <option value="652">Brighton</option>
                        <option value="765">BTM</option>
                        <option value="779">BTM China</option>
                        <option value="696">Carlton Forge Works</option>
                        <option value="729">Chengde</option>
                        <option value="653">Cleveland</option>
                        <option value="736">Dickson Testing Company</option>
                        <option value="655">Division Office</option>
                        <option value="650">Grafton</option>
                        <option value="728">Hackney-Ladish</option>
                        <option value="642">Houston - Energy</option>
                        <option value="725">Houston - Turbine</option>
                        <option value="704">KLAD</option>
                        <option value="644">Lincoln</option>
                        <option value="643">Livingston</option>
                        <option value="789">McWilliams</option>
                        <option value="649">Monterrey</option>
                        <option value="648">Plzen</option>
                        <option value="654">Princeton</option>
                        <option value="731">RathGibson - Greenville</option>
                        <option value="730">RathGibson - Janesville</option>
                        <option value="732">RathGibson - North Branch</option>
                        <option value="705">Rollmet</option>
                        <option value="788">Summit</option>
                        <option value="749">Texas Honing/THI</option>
                        <option value="710">TruForm</option>
                        <option value="707">Tyseley</option>
                        <option value="776">Wilkes-Barre</option>
                        <option value="651">Worcester</option>
                        <option value="706">Wyman-Gordon PA (Mountaintop)</option>
                        </optgroup>
                      </select>
        </td>
      </tr>
      <tr>
        <td align="right">Originator: </td>
        <td><input type="text" name="param_originator_s_n_125" value=""></td>
      </tr>
      <tr>
        <td align="right">Project Title: </td>
        <td><input type="text" name="param_project~title_s_n_255" value=""></td>
      </tr>
      <tr>
        <td align="right">Current Approver: </td>
        <td><input type="text" name="param_current~approver_s_n_125" value=""></td>
        <tr>
        <td align="right">Current Status: </td>
        <td><select name="param_current~status_s_n_60">
            <option value="">ANY</option>
           <option value="OPEN">OPEN</option>
                    <option value="IN PROCESS">IN PROCESS</option>
                    <option value="APPROVED">APPROVED</option>
                    <option value="RECALLED">RECALLED</option>
                    <option value="REJECTED">REJECTED</option>
                    <option value="TERMINATED">TERMINATED</option>
          </select></td>
      </tr>
      <tr>
        <td colspan="2">Created Between: </td>
      </tr>
      <tr>  
        <td colspan="2"><input type="text" id="date_from" size="10" name="param_created~from_dte_n_10" value="">
          and
          <input type="text" id="date_to" size="10" name="param_created~to_dte_n_10" value=""></td>
      </tr>
      <tr>
        <td colspan="2">Last modified Between: </td>
      </tr>
      <tr>
        <td colspan="2"><input type="text" id="modified_from" size="10" name="param_modified~from_dte_n_10" value="">
          and
          <input type="text" id="modified_to" size="10" name="param_modified~to_dte_n_10" value=""></td>
      </tr>
      <tr>
        <td colspan="2" >Amount (in USD) between: </td>
      </tr>
      <tr>
        <td colspan="2"><input type="text" size="10" name="param_amount~from_m_n_20" value="">
          and
          <input type="text" size="10" name="param_amount~to_m_n_20" value=""></td>
      </tr>
      <tr>
        <td colspan="2"><input type="submit" name="searchform" value="Search"></td>
      </tr>
    </tbody>
</table>
                        
                        
                    </form>
                </div>
                
                <!-- first list when you land on the page -->
                <div id="carList"> 
                    <h3>CAR Dashboard</h3>
                    <!-- content inserted here from ecar.js -->
                    <ul id="currentCARS">
                        <script id="current-cars" type="text/x-handlebars-template">
                            <li class="paddingFive" style="background-color: {{taskColor}}"> 
                                <a href="{{carDetailsUrl}}">{{carTitle}}</a><br/>
                                <span class="small">ID: {{carID}} &nbsp; &nbsp; Status: {{carStatus}}</span>
                                <hr>
                            </li>
                        </script>               
                    </ul>
                </div>
                
                <!-- a CAR id was passed in so, get the details -->
                <div id="carDetails">
                    <script id="car-details" type="text/x-display-template">
                        
                        <div id="carDetailsActionButtons" class="center paddingFive" style="margin-top:5px;">
                            <a id="approveCARButton" class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.displayApproveCAR('{{carID}}')">Approve</a> 
                            <a id="rejectCARButton"  class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.displayRejectCAR('{{carID}}')">Reject</a> 
                            <a id="forwardCARButton" class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.displayForwardCAR('{{carID}}')">Forward</a>
                            <a id="recallCARButton" class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.displayRecallCAR('{{carID}}')">Recall</a>
                        </div>
                        
                        <!-- if this task is rejected, show the terminage button                        -->
                        <div id="carTerminateDiv" class="center paddingFive" style="margin-top:5px;">
                            <a id="terminateCARButton" class="pccBlue rounded-corners paddingFive" href="javascript:Ecar.displayTerminateCAR('{{carID}}')">Terminate</a>    
                        </div>
                        
                        <!-- aligned right grey call out box -->
                        <h3>{{carDisplayName}}</h3>
                        <dl id="carDetailsPullout" class="rounded-corners">
                            <dt>Plant</dt>
                             <dd>{{carPlant}}</dd>
                            <dt>Division</dt>
                            <dd>{{carDivision}}</dd>
                            <dt>Status</dt>
                            <dd>{{carStatus}}</dd>   
                        </dl>
                        
                        <dl id="carDetailsMainDL">
                            <dt>Project Title</dt>
                            <dd>{{carProjectTitle}}</dd>
                            <dt>Originator</dt>
                            <dd>{{carOriginator}}</dd>
                            <dt>Type</dt>
                            <dd>{{carType}}</dd>
                            <dt>Comments</dt>
                            <dd>{{carComments}}</dd>
                            <dt>Owner</dt>
                             <dd>{{carOwner}}</dd>
                            <dt>Current Approver Name</dt>
                            <dd>{{carCurrentApproverName}}</dd>
                            <dt>Amount</dt>
                            <dd>{{carAmount}}({{carCurrency}})</dd>
                            <dt>Purpose</dt>
                            <dd>{{carPurpose}}</dd>
                           <dt>Second Originator</dt>
                            <dd>{{carSecondOriginator}}</dd>
                            <dt>IT Policy Number</dt>
                            <dd>{{carITPolicyNumber}}</dd>
                           <dt>Rush?</dt>
                            <dd>{{carRush}}</dd>
                            <dt>Rush Reason</dt>
                            <dd>{{carRushReason}}</dd>
                            <dt>NPV</dt>
                            <dd>{{carNPV}}</dd>
                           <dt>IRR</dt>
                            <dd>{{carIRR}}</dd>
                           <dt>Is Budgeted?</dt>
                            <dd>{{carIsBudgeted}}</dd>
                           <dt>Exchange Rate</dt>
                            <dd>{{carExchangeRate}}</dd>
                           <dt>Equated USD Amount</dt>
                            <dd>{{carEquatedUSDAmount}}</dd>
                           <dt>For Consulting?</dt>
                            <dd>{{carForConsulting}}</dd>
                           <dt>Is Import/Export?</dt>
                            <dd>{{carIsImportExport}}</dd>
                           <dt>Is Lease?</dt>
                            <dd>{{carIsLease}}</dd>
                        </dl>                        
                    </script>
                </div> <!-- end car details -->
                
                <br clear="all"/>
                
                <!-- car attachments; these are set up seperatly so the templates can be repeated -->
                <div id="carAttachments">
                    <h4></h4>
                    <!-- opening arrow goes here from ecar.js -->
                    <div id="carAttachmentsList">
                        <script id="car-attachments" type="text/x-display-template">
                            {{carAttachmentCreationDate}}: <a href="javascript:Ecar.getAttachment('{{carAttachmentURL}}')">{{carAttachmentFilename}}</a><br/>
                            Uploaded by: {{carAttachmentUploadBy}} <br/>
                            Modified: {{carAttachmentModifyDate}} <br/>
                            <hr>
                        </script>
                    </div>
                </div><!-- end car attachments -->
                
                <br clear="all"/>
               
                <!-- car approvers; these are set up seperatly so the templates can be repeated -->
                <div id="carApprovers">
                    <h4></h4>
                    <div id="carApproversList">
                        <script id="car-approvers" type="text/x-display-template">
                            Approver: {{carApproversName}}<br/>
                            Timestamp: {{carApproversTimestamp}}<br/>
                            Comments: {{carApproversComments}}<br/>
                            Version: {{carApproversVersion}}<br/>
                            Level: {{carApproversLevelName}}<br/>
                            Disposition: {{carApproversStatus}}<br/>
                            <!--
                            Created: {{carApproversCreationDate}}<br/>
                            Modified: {{carApproversModifyDate}}<br/>
                            Close Date: {{carApproversCloseDate}}<br/>
                            Delegated: {{carApproversDelegatedTo}}<br/>
                            Closed: {{carApproversIsClosed}}<br/>
                            PRP ID: {{carApproversPRPID}}<br/>
                            Priority: {{carApproversPriority}}<br/>
                            Approver: Priority: {{carApproversApproverPriority}}<br/>
                            Rush? {{carApproversRush}}<br/>
                            Rush Reason: {{carApproversRushReason}}<br/>
                            Last Reminder: {{carApproversLastReminderDate}}<br/>
                            Is Internal? {{carApproversIsInternal}}<br/>
                            Group: {{carApproversApproverGroup}}<br/>
                            History: {{carApproversCommentHashHistory}}<br/>
                            -->
                            <hr>
                        </script>
                    </div>
                </div><!-- end car approvers -->
                
                <!-- approve CAR form -->
                <div id="carApproveForm">
                    <h4>Approve CAR</h4>
                    <p>Please add comments to the form below.</p>
                    <script id="car-approve-template" type="text/x-display-template">
                        <form>
                            <textarea cols=45 rows=10 name="comments" id="comments"></textarea>
                            <input type="hidden" value="{{carID}}" name="car_id" id="car_id"/><br/>
                            <a  class="center" href="#" onclick="Ecar.approveCAR($('#car_id').val(), $('textarea#comments').val())" id="approveLink"><div id="approveButton" class="pccBlue rounded-corners paddingFive"> Send Approval with Comments</div></a>
                        </form>
                    </script>
                </div>
                
                <!-- reject CAR form -->
                <div id="carRejectForm">
                    <h4>Reject CAR</h4>
                    <p>Please add comments to the form below.</p>
                    <script id="car-reject-template" type="text/x-display-template">
                        <form>
                            <textarea cols=45 rows=10 name="comments" id="comments"></textarea>
                            <input type="hidden" value="{{carID}}" name="car_id" id="car_id"/><br/>
                            <a class="center" href="#" onclick="Ecar.rejectCAR($('#car_id').val(), $('textarea#comments').val())" id="rejectLink"><div id="rejectButton" class="pccBlue rounded-corners paddingFive"> Send Rejection with Comments</div></a>
                        </form>
                    </script>
                </div>

                <!-- forward CAR form -->
                <div id="carForwardForm">
                    <h4>Forward CAR</h4>
                    <p>Please enter the email address of the person to forward too. If more than one email address, please separate by <strong>commas</strong>. Please note that emails must be a valid PCC domain address.</p>
                    <script id="car-forward-template" type="text/x-display-template">
                        <form>
                            Emails: <input type="text" name="email" id="email"/><br/><br/>
                            Comments:<br/>
                            <textarea cols=45 rows=10 name="comments" id="comments"></textarea><br/>
                            <input type="hidden" value="{{carID}}" name="car_id" id="car_id"/><br/>
                            <a class="center"  href="#" onclick="Ecar.forwardCAR($('#car_id').val(), $('textarea#comments').val(), $('#email').val())" id="forwardLink"><div id="forwardButton" class="pccBlue rounded-corners paddingFive"> Forward CAR</div></a>
                        </form>
                    </script>
                </div>

                <div id="carRecallForm">
                    <h4>Recall CAR</h4>
                    <p>Please add comments to the form below.</p>
                    <script id="car-recall-template" type="text/x-display-template">
                        <form>
                            <textarea cols=45 rows=10 name="comments" id="comments"></textarea>
                            <input type="hidden" value="{{carID}}" name="car_id" id="car_id"/><br/>
                            <a  class="center" href="#" onclick="Ecar.recallCAR($('#car_id').val(), $('textarea#comments').val())" id="recallLink"><div id="recallButton" class="pccBlue rounded-corners paddingFive"> Send Recall with Comments</div></a>
                        </form>
                    </script>
                </div>

                <!-- terminate CAR form :: for after the rejection, you can terminate this. -->
                <div id="carTerminateForm">
                    <h4>Terminate CAR</h4>
                    <p>Please enter your comments for this termination.</p>
                    <script id="car-terminate-template" type="text/x-display-template">
                        <form>
                            Comments:<br/>
                            <textarea cols=45 rows=10 name="comments" id="comments"></textarea><br/>
                            <input type="hidden" value="{{carID}}" name="car_id" id="car_id"/><br/>
                            <a class="center"  href="#" onclick="Ecar.terminateCAR($('#car_id').val(), $('textarea#comments').val(), $('#email').val())" id="terminateLink"><div id="terminateButton" class="pccBlue rounded-corners paddingFive"> Terminate CAR</div></a>
                        </form>
                    </script>
                </div>

                <!-- for the attachment pop up; the iframe will be loaded from Ecar.getAttachment() -->        
                <div id="attachmentPopUpDiv">
                    <a href="javascript:Ecar.closeAttachmentPopUpDiv()"><img src='close_icon.png' width=32 height=32 id='overlayCloseButton' /></a>
                    <iframe id="attachmentPopUpFrame"></iframe>
                </div>
                
            </div><!-- end centered -->
        </div><!-- end container -->
        
        <!-- waiting for something to happen so, show this -->
        <div id="spinner" class="pccBlue rounded-corners">
            <img src="spinner.gif" width="80" height="80">
            <p id="spinnerMsg">Please Wait...</p>
        </div>
        

       <script type="text/javascript" src="jquery.js"></script>
       <script type="text/javascript" src="index.js"></script>
       <script src="websql-store-init.js"></script>
       <script src="ecar.js"></script>
       
       <!--<script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script src="js/websql-store-init.js"></script>
        <script src="js/ecar.js"></script>-->

        <script type="text/javascript">
            // did we get an car_id passed? Else, init and get  a list for this user
            var carID = app.urlParam()["car_id"];
            if (typeof carID != 'undefined') {
                // pass in the whole key/value string because they come from the database and might change
                var wholeQueryString = window.location.search;
                Ecar.getECARDetails(wholeQueryString);
            } else {
                Ecar.init(); // init -> start this off by checking the login to see if they have a session
            }
        </script>
    </body>
</html>
